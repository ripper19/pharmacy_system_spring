<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pharmacy Dashboard - Medicines Management</title>
    <link rel="stylesheet" href="css/dash.css">
    <style>
        /* Medicines management styles */
        .medicines-management {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .medicines-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            background: #f5f5f5;
            color: #333;
        }

        .action-btn.active {
            background: #4caf50;
            color: white;
        }

        .action-btn:hover:not(.active) {
            background: #e0e0e0;
        }

        .medicines-form {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4caf50;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .primary-btn {
            padding: 10px 25px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
        }

        .primary-btn:hover {
            background: #388e3c;
        }

        .secondary-btn {
            padding: 10px 25px;
            background: #f5f5f5;
            color: #333;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
        }

        .secondary-btn:hover {
            background: #e0e0e0;
        }

        .medicines-table-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .medicines-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .medicines-table th {
            background: #f5f5f5;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #ddd;
        }

        .medicines-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        .medicines-table tr:hover {
            background: #f9f9f9;
        }

        .stock-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .stock-high {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .stock-medium {
            background: #fff3e0;
            color: #ef6c00;
        }

        .stock-low {
            background: #ffebee;
            color: #c62828;
        }

        .stock-out {
            background: #f5f5f5;
            color: #757575;
        }

        .action-cell {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .edit-btn {
            background: #e3f2fd;
            color: #1976d2;
        }

        .delete-btn {
            background: #ffebee;
            color: #d32f2f;
        }

        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .search-btn {
            padding: 10px 20px;
            background: #2196f3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .hidden {
            display: none;
        }

        .message {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            text-align: center;
        }

        .success {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }

        .warning {
            background: #fff3e0;
            color: #ef6c00;
            border: 1px solid #ffe0b2;
        }

        .stock-check-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .stock-result {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #4caf50;
        }

        .medicine-type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .type-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .type-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .type-count {
            font-size: 24px;
            font-weight: 700;
            color: #4caf50;
            margin: 10px 0;
        }

        .type-status {
            font-size: 12px;
            color: #666;
        }

        /* Modal for medicine types */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            width: 500px;
            max-width: 90%;
            margin: 50px auto;
            border-radius: 10px;
            padding: 20px;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .medicine-types-list {
            max-height: 400px;
            overflow-y: auto;
            margin: 15px 0;
        }

        .type-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
        }

        .type-item:last-child {
            border-bottom: none;
        }

        .type-actions {
            display: flex;
            gap: 8px;
        }

        .small-btn {
            padding: 4px 10px;
            font-size: 12px;
        }

        .danger-btn {
            background: #ffebee;
            color: #d32f2f;
            border: 1px solid #ffcdd2;
        }
    </style>
</head>
<body>

<!-- Horizontal Navbar -->
<div class="top-navbar">
    <div class="logo" style="font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode';">PHARMACARE</div>
    <div class="search-bar">
        <input type="text" placeholder="Search medicines, sales">
    </div>
    <div class="nav-actions">
        <button onclick="showNotifications()">üîî Notifications</button>
        <button onclick="logout()">Logout</button>
    </div>
</div>

<!-- Vertical Sidebar -->
<div class="sidebar">
    <div class="user-profile">
        <div class="user-avatar" id="userAvatar">JD</div>
        <div class="user-name" id="userName">John Doe</div>
        <div class="user-role" id="userRole">Pharmacist</div>
    </div>

    <div class="menu">
        <a href="dashboard.html" class="menu-item">
            <span class="menu-icon">üìä</span>
            <span>Dashboard</span>
        </a>
        <a href="sales.html" class="menu-item">
            <span class="menu-icon">üí∞</span>
            <span>Sales</span>
        </a>
        <a href="inventory.html" class="menu-item">
            <span class="menu-icon">üì¶</span>
            <span>Inventory</span>
        </a>
        <a href="#" class="menu-item active">
            <span class="menu-icon">üíä</span>
            <span>Medicines</span>
        </a>
        <a href="reports.html" class="menu-item">
            <span class="menu-icon">üìà</span>
            <span>Reports</span>
        </a>
        <a href="staff.html" class="menu-item">
            <span class="menu-icon">üë•</span>
            <span>Staff</span>
        </a>
        <a href="settings.html" class="menu-item">
            <span class="menu-icon">‚öôÔ∏è</span>
            <span>Settings</span>
        </a>
    </div>
</div>

<!-- Main Content -->
<div class="main-content">
    <div class="page-header">
        <h1>Medicines Management</h1>
        <p>Manage medicine inventory, stock levels, and medicine types</p>
    </div>

    <!-- Medicines Management Section -->
    <div class="medicines-management">
        <div class="medicines-header">
            <h2>Medicine Operations</h2>
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Search medicines by name, SKU or type..." id="medicineSearch">
                <button class="search-btn" onclick="searchMedicines()">Search</button>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="action-btn active" onclick="setMode('add')">‚ûï Add Medicine</button>
            <button class="action-btn" onclick="setMode('update')">‚úèÔ∏è Update Medicine</button>
            <button class="action-btn" onclick="setMode('delete')">üóëÔ∏è Delete Medicine</button>
            <button class="action-btn" onclick="setMode('stock-check')">üìã Check Single Stock</button>
            <button class="action-btn" onclick="setMode('stock-by-type')">üìä Stock by Type</button>
            <button class="action-btn" onclick="setMode('view')">üëÅÔ∏è View All Medicines</button>
            <button class="action-btn" onclick="openMedicineTypesModal()">üè∑Ô∏è Manage Types</button>
        </div>

        <!-- Message Area -->
        <div id="messageArea"></div>

        <!-- Single Form (Changes based on mode) -->
        <div class="medicines-form" id="medicinesForm">
            <!-- Add Medicine Form -->
            <div id="addForm">
                <h3>Add New Medicine</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="sku">SKU *</label>
                        <input type="text" id="sku" placeholder="MED-001">
                    </div>
                    <div class="form-group">
                        <label for="medicineName">Medicine Name *</label>
                        <input type="text" id="medicineName" placeholder="Paracetamol 500mg">
                    </div>
                    <div class="form-group">
                        <label for="medicineType">Medicine Type *</label>
                        <select id="medicineType">
                            <option value="">Select Type</option>
                            <option value="analgesic">Analgesic</option>
                            <option value="antibiotic">Antibiotic</option>
                            <option value="antiviral">Antiviral</option>
                            <option value="antifungal">Antifungal</option>
                            <option value="antihistamine">Antihistamine</option>
                            <option value="supplement">Supplement</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="quantity">Quantity *</label>
                        <input type="number" id="quantity" placeholder="100" min="0">
                    </div>
                    <div class="form-group">
                        <label for="lowStockThreshold">Low Stock Threshold *</label>
                        <input type="number" id="lowStockThreshold" placeholder="10" min="1">
                        <small style="color: #666; margin-top: 4px;">Alert when stock falls below this number</small>
                    </div>
                    <div class="form-group" style="grid-column: span 2;">
                        <label for="description">Description</label>
                        <textarea id="description" placeholder="Enter medicine description, usage instructions, etc."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="price">Price per unit (KSh)</label>
                        <input type="number" id="price" placeholder="50" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label for="expiryDate">Expiry Date</label>
                        <input type="date" id="expiryDate">
                    </div>
                </div>
                <div class="form-actions">
                    <button class="secondary-btn" onclick="clearForm()">Clear</button>
                    <button class="primary-btn" onclick="addMedicine()">Add Medicine</button>
                </div>
            </div>

            <!-- Update Medicine Form -->
            <div id="updateForm" class="hidden">
                <h3>Update Medicine Information</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="updateSku">SKU to Update *</label>
                        <input type="text" id="updateSku" placeholder="Enter medicine SKU" onchange="loadMedicineData()">
                    </div>
                    <div class="form-group">
                        <label for="updateName">Medicine Name</label>
                        <input type="text" id="updateName">
                    </div>
                    <div class="form-group">
                        <label for="updateType">Medicine Type</label>
                        <select id="updateType">
                            <option value="">Select Type</option>
                            <option value="analgesic">Analgesic</option>
                            <option value="antibiotic">Antibiotic</option>
                            <option value="antiviral">Antiviral</option>
                            <option value="antifungal">Antifungal</option>
                            <option value="antihistamine">Antihistamine</option>
                            <option value="supplement">Supplement</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="updateQuantity">Quantity</label>
                        <input type="number" id="updateQuantity" min="0">
                    </div>
                    <div class="form-group">
                        <label for="updateThreshold">Low Stock Threshold</label>
                        <input type="number" id="updateThreshold" min="1">
                    </div>
                    <div class="form-group">
                        <label for="updatePrice">Price per unit (KSh)</label>
                        <input type="number" id="updatePrice" step="0.01" min="0">
                    </div>
                </div>
                <div class="form-actions">
                    <button class="secondary-btn" onclick="clearUpdateForm()">Cancel</button>
                    <button class="primary-btn" onclick="updateMedicine()">Update Medicine</button>
                </div>
            </div>

            <!-- Delete Medicine Form -->
            <div id="deleteForm" class="hidden">
                <h3>Delete Medicine</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="deleteName">Medicine Name to Delete *</label>
                        <input type="text" id="deleteName" placeholder="Enter medicine name">
                    </div>
                    <div class="form-group">
                        <label for="confirmDeleteMedicine">Confirm SKU</label>
                        <input type="text" id="confirmDeleteMedicine" placeholder="Type medicine SKU to confirm">
                    </div>
                </div>
                <div class="form-actions">
                    <button class="secondary-btn" onclick="clearDeleteForm()">Cancel</button>
                    <button class="primary-btn" onclick="deleteMedicine()" style="background: #d32f2f;">Delete Medicine</button>
                </div>
            </div>

            <!-- Check Single Stock Form -->
            <div id="stockCheckForm" class="hidden">
                <h3>Check Stock for Single Medicine</h3>
                <div class="stock-check-container">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="checkMedicineName">Medicine Name *</label>
                            <input type="text" id="checkMedicineName" placeholder="Enter medicine name">
                        </div>
                        <div class="form-group">
                            <button class="primary-btn" onclick="checkStock()" style="margin-top: 25px;">Check Stock</button>
                        </div>
                    </div>
                    <div id="stockResult" class="stock-result hidden">
                        <!-- Stock result will be displayed here -->
                    </div>
                </div>
            </div>

            <!-- Stock by Type Form -->
            <div id="stockByTypeForm" class="hidden">
                <h3>Check Stock by Medicine Type</h3>
                <div class="stock-check-container">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="checkMedicineType">Medicine Type *</label>
                            <select id="checkMedicineType">
                                <option value="">Select Type</option>
                                <option value="analgesic">Analgesic</option>
                                <option value="antibiotic">Antibiotic</option>
                                <option value="antiviral">Antiviral</option>
                                <option value="antifungal">Antifungal</option>
                                <option value="antihistamine">Antihistamine</option>
                                <option value="supplement">Supplement</option>
                                <option value="all">All Types</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button class="primary-btn" onclick="checkStockByType()" style="margin-top: 25px;">Check Stock</button>
                        </div>
                    </div>
                    <div id="stockByTypeResult" class="hidden">
                        <!-- Stock by type result will be displayed here -->
                    </div>
                </div>
            </div>

            <!-- View Medicines Table -->
            <div id="viewTable" class="hidden">
                <h3>All Medicines Inventory</h3>
                <div class="medicines-table-container">
                    <table class="medicines-table" id="medicinesTable">
                        <thead>
                        <tr>
                            <th>SKU</th>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Quantity</th>
                            <th>Threshold</th>
                            <th>Status</th>
                            <th>Price</th>
                            <th>Actions</th>
                        </tr>
                        </thead>
                        <tbody id="medicinesTableBody">
                        <!-- Medicine data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Medicine Types Modal -->
<div id="medicineTypesModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Manage Medicine Types</h3>
            <button class="close-modal" onclick="closeMedicineTypesModal()">&times;</button>
        </div>

        <div class="form-grid">
            <div class="form-group">
                <label for="newTypeName">New Type Name</label>
                <input type="text" id="newTypeName" placeholder="Enter new medicine type">
            </div>
            <div class="form-group">
                <button class="primary-btn" onclick="addMedicineType()" style="margin-top: 25px;">Add Type</button>
            </div>
        </div>

        <div class="medicine-types-list" id="medicineTypesList">
            <!-- Types will be loaded here -->
        </div>
    </div>
</div>

<script>
    // Current mode state
    let currentMode = 'add';

    // Sample medicine data
    let medicinesData = [
        { sku: 'MED-001', name: 'Paracetamol 500mg', type: 'analgesic', quantity: 150, threshold: 20, price: 50, description: 'Pain reliever and fever reducer', expiryDate: '2024-12-31' },
        { sku: 'MED-002', name: 'Amoxicillin 250mg', type: 'antibiotic', quantity: 45, threshold: 15, price: 120, description: 'Broad-spectrum antibiotic', expiryDate: '2024-08-15' },
        { sku: 'MED-003', name: 'Vitamin C 1000mg', type: 'supplement', quantity: 200, threshold: 25, price: 80, description: 'Immune system support', expiryDate: '2025-03-20' },
        { sku: 'MED-004', name: 'Cetirizine 10mg', type: 'antihistamine', quantity: 8, threshold: 10, price: 65, description: 'Antihistamine for allergies', expiryDate: '2024-10-31' },
        { sku: 'MED-005', name: 'Ibuprofen 400mg', type: 'analgesic', quantity: 85, threshold: 15, price: 75, description: 'NSAID for pain and inflammation', expiryDate: '2024-11-30' },
        { sku: 'MED-006', name: 'Fluconazole 150mg', type: 'antifungal', quantity: 30, threshold: 10, price: 200, description: 'Antifungal medication', expiryDate: '2025-01-15' }
    ];

    // Medicine types
    let medicineTypes = ['analgesic', 'antibiotic', 'antiviral', 'antifungal', 'antihistamine', 'supplement', 'other'];

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
        updateButtonStates();
        renderMedicinesTable();
    });

    // Set mode and update UI
    function setMode(mode) {
        currentMode = mode;
        updateButtonStates();
        showCurrentForm();
    }

    // Update button active states
    function updateButtonStates() {
        const buttons = document.querySelectorAll('.action-btn');
        buttons.forEach(btn => {
            let btnMode = 'add';
            if (btn.textContent.includes('Update')) btnMode = 'update';
            else if (btn.textContent.includes('Delete')) btnMode = 'delete';
            else if (btn.textContent.includes('Single')) btnMode = 'stock-check';
            else if (btn.textContent.includes('Type')) btnMode = 'stock-by-type';
            else if (btn.textContent.includes('View')) btnMode = 'view';
            else if (btn.textContent.includes('Manage')) btnMode = 'types';

            btn.classList.toggle('active', btnMode === currentMode);
        });
    }

    // Show the appropriate form based on mode
    function showCurrentForm() {
        // Hide all forms
        document.getElementById('addForm').classList.add('hidden');
        document.getElementById('updateForm').classList.add('hidden');
        document.getElementById('deleteForm').classList.add('hidden');
        document.getElementById('stockCheckForm').classList.add('hidden');
        document.getElementById('stockByTypeForm').classList.add('hidden');
        document.getElementById('viewTable').classList.add('hidden');

        // Show the active form
        if (currentMode === 'add') {
            document.getElementById('addForm').classList.remove('hidden');
        } else if (currentMode === 'update') {
            document.getElementById('updateForm').classList.remove('hidden');
        } else if (currentMode === 'delete') {
            document.getElementById('deleteForm').classList.remove('hidden');
        } else if (currentMode === 'stock-check') {
            document.getElementById('stockCheckForm').classList.remove('hidden');
        } else if (currentMode === 'stock-by-type') {
            document.getElementById('stockByTypeForm').classList.remove('hidden');
        } else if (currentMode === 'view') {
            document.getElementById('viewTable').classList.remove('hidden');
            renderMedicinesTable();
        }
    }

    // Add new medicine
    function addMedicine() {
        const sku = document.getElementById('sku').value;
        const name = document.getElementById('medicineName').value;
        const type = document.getElementById('medicineType').value;
        const quantity = parseInt(document.getElementById('quantity').value);
        const threshold = parseInt(document.getElementById('lowStockThreshold').value);

        // Basic validation
        if (!sku || !name || !type || isNaN(quantity) || isNaN(threshold)) {
            showMessage('Please fill in all required fields (*)', 'error');
            return;
        }

        // Check if SKU already exists
        if (medicinesData.some(med => med.sku === sku)) {
            showMessage('SKU already exists!', 'error');
            return;
        }

        // Add new medicine
        const newMedicine = {
            sku: sku,
            name: name,
            type: type,
            quantity: quantity,
            threshold: threshold,
            price: parseFloat(document.getElementById('price').value) || 0,
            description: document.getElementById('description').value || '',
            expiryDate: document.getElementById('expiryDate').value || ''
        };

        medicinesData.push(newMedicine);
        showMessage(`Medicine ${name} added successfully!`, 'success');
        clearForm();
        renderMedicinesTable();
    }

    // Load medicine data for updating
    function loadMedicineData() {
        const sku = document.getElementById('updateSku').value;
        const medicine = medicinesData.find(m => m.sku === sku);

        if (medicine) {
            document.getElementById('updateName').value = medicine.name;
            document.getElementById('updateType').value = medicine.type;
            document.getElementById('updateQuantity').value = medicine.quantity;
            document.getElementById('updateThreshold').value = medicine.threshold;
            document.getElementById('updatePrice').value = medicine.price;
        } else {
            showMessage('SKU not found!', 'error');
            clearUpdateForm();
        }
    }

    // Update medicine information
    function updateMedicine() {
        const sku = document.getElementById('updateSku').value;
        const medicineIndex = medicinesData.findIndex(m => m.sku === sku);

        if (medicineIndex === -1) {
            showMessage('SKU not found!', 'error');
            return;
        }

        // Update medicine data
        medicinesData[medicineIndex] = {
            ...medicinesData[medicineIndex],
            name: document.getElementById('updateName').value || medicinesData[medicineIndex].name,
            type: document.getElementById('updateType').value || medicinesData[medicineIndex].type,
            quantity: parseInt(document.getElementById('updateQuantity').value) || medicinesData[medicineIndex].quantity,
            threshold: parseInt(document.getElementById('updateThreshold').value) || medicinesData[medicineIndex].threshold,
            price: parseFloat(document.getElementById('updatePrice').value) || medicinesData[medicineIndex].price
        };

        showMessage(`Medicine ${sku} updated successfully!`, 'success');
        clearUpdateForm();
        renderMedicinesTable();
    }

    // Delete medicine
    function deleteMedicine() {
        const name = document.getElementById('deleteName').value;
        const confirmSku = document.getElementById('confirmDeleteMedicine').value;

        if (!name) {
            showMessage('Please enter a medicine name', 'error');
            return;
        }

        const medicine = medicinesData.find(m => m.name.toLowerCase() === name.toLowerCase());
        if (!medicine) {
            showMessage('Medicine not found!', 'error');
            return;
        }

        // Safety confirmation
        if (confirmSku !== medicine.sku) {
            showMessage('SKU does not match! Please type the exact medicine SKU to confirm deletion.', 'error');
            return;
        }

        // Remove medicine
        medicinesData = medicinesData.filter(m => m.sku !== medicine.sku);
        showMessage(`Medicine ${medicine.name} deleted successfully!`, 'success');
        clearDeleteForm();
        renderMedicinesTable();
    }

    // Check stock for single medicine
    function checkStock() {
        const name = document.getElementById('checkMedicineName').value;
        if (!name) {
            showMessage('Please enter a medicine name', 'error');
            return;
        }

        const medicine = medicinesData.find(m => m.name.toLowerCase().includes(name.toLowerCase()));
        if (!medicine) {
            showMessage('Medicine not found!', 'error');
            return;
        }

        const stockStatus = getStockStatus(medicine.quantity, medicine.threshold);
        const statusClass = getStockStatusClass(stockStatus);

        document.getElementById('stockResult').innerHTML = `
            <h4>${medicine.name} (${medicine.sku})</h4>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 15px;">
                <div>
                    <strong>Current Stock:</strong>
                    <div style="font-size: 28px; font-weight: bold; color: ${getStockColor(medicine.quantity, medicine.threshold)}">${medicine.quantity}</div>
                </div>
                <div>
                    <strong>Threshold:</strong>
                    <div style="font-size: 20px; color: #666;">${medicine.threshold}</div>
                </div>
                <div>
                    <strong>Type:</strong>
                    <div>${medicine.type}</div>
                </div>
                <div>
                    <strong>Price:</strong>
                    <div>KSh ${medicine.price.toFixed(2)}</div>
                </div>
                <div>
                    <strong>Status:</strong>
                    <div><span class="stock-badge ${statusClass}">${stockStatus}</span></div>
                </div>
                <div>
                    <strong>Safety Margin:</strong>
                    <div>${Math.max(0, medicine.quantity - medicine.threshold)} units</div>
                </div>
            </div>
            ${medicine.quantity <= medicine.threshold ?
                `<div style="margin-top: 15px; padding: 10px; background: #ffebee; border-radius: 5px; color: #c62828;">
                    ‚ö†Ô∏è <strong>Low Stock Alert:</strong> Consider reordering soon!
                </div>` : ''}
        `;
        document.getElementById('stockResult').classList.remove('hidden');
    }

    // Check stock by medicine type
    function checkStockByType() {
        const type = document.getElementById('checkMedicineType').value;
        if (!type) {
            showMessage('Please select a medicine type', 'error');
            return;
        }

        const filtered = type === 'all'
            ? medicinesData
            : medicinesData.filter(m => m.type === type);

        if (filtered.length === 0) {
            document.getElementById('stockByTypeResult').innerHTML = `
                <div class="message warning">No medicines found for type: ${type}</div>
            `;
            document.getElementById('stockByTypeResult').classList.remove('hidden');
            return;
        }

        // Calculate totals
        const totalQuantity = filtered.reduce((sum, med) => sum + med.quantity, 0);
        const totalValue = filtered.reduce((sum, med) => sum + (med.quantity * med.price), 0);
        const lowStockCount = filtered.filter(med => med.quantity <= med.threshold).length;

        // Group by type if showing all
        let typeSummary = '';
        if (type === 'all') {
            const typeGroups = {};
            filtered.forEach(med => {
                if (!typeGroups[med.type]) typeGroups[med.type] = { count: 0, quantity: 0 };
                typeGroups[med.type].count++;
                typeGroups[med.type].quantity += med.quantity;
            });

            typeSummary = `
                <div class="medicine-type-grid">
                    ${Object.entries(typeGroups).map(([typeName, data]) => `
                        <div class="type-card">
                            <div class="type-name">${typeName}</div>
                            <div class="type-count">${data.count}</div>
                            <div class="type-status">Medicines</div>
                            <div style="margin-top: 8px; font-size: 12px; color: #666;">Total: ${data.quantity} units</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        document.getElementById('stockByTypeResult').innerHTML = `
            <div class="stock-result">
                <h4>Stock Summary${type !== 'all' ? ` for ${type}` : ''}</h4>
                ${type === 'all' ? typeSummary : ''}

                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px;">
                    <div style="text-align: center; padding: 15px; background: #e8f5e9; border-radius: 8px;">
                        <div style="font-size: 12px; color: #666;">Total Medicines</div>
                        <div style="font-size: 28px; font-weight: bold; color: #2e7d32;">${filtered.length}</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #e3f2fd; border-radius: 8px;">
                        <div style="font-size: 12px; color: #666;">Total Quantity</div>
                        <div style="font-size: 28px; font-weight: bold; color: #1976d2;">${totalQuantity}</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: ${lowStockCount > 0 ? '#fff3e0' : '#e8f5e9'}; border-radius: 8px;">
                        <div style="font-size: 12px; color: #666;">Low Stock Items</div>
                        <div style="font-size: 28px; font-weight: bold; color: ${lowStockCount > 0 ? '#ef6c00' : '#2e7d32'};">${lowStockCount}</div>
                    </div>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <strong>Inventory Value:</strong> KSh ${totalValue.toFixed(2)}
                </div>
            </div>
        `;
        document.getElementById('stockByTypeResult').classList.remove('hidden');
    }

    // Render medicines table
    function renderMedicinesTable() {
        const tableBody = document.getElementById('medicinesTableBody');
        tableBody.innerHTML = '';

        medicinesData.forEach(medicine => {
            const stockStatus = getStockStatus(medicine.quantity, medicine.threshold);
            const statusClass = getStockStatusClass(stockStatus);

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${medicine.sku}</td>
                <td><strong>${medicine.name}</strong><br><small style="color: #666;">${medicine.description.substring(0, 50)}${medicine.description.length > 50 ? '...' : ''}</small></td>
                <td>${medicine.type}</td>
                <td>${medicine.quantity}</td>
                <td>${medicine.threshold}</td>
                <td><span class="stock-badge ${statusClass}">${stockStatus}</span></td>
                <td>KSh ${medicine.price.toFixed(2)}</td>
                <td class="action-cell">
                    <button class="icon-btn edit-btn" onclick="editMedicine('${medicine.sku}')">Edit</button>
                    <button class="icon-btn delete-btn" onclick="confirmDeleteMedicine('${medicine.sku}', '${medicine.name}')">Delete</button>
                    <button class="icon-btn" style="background: #e8f5e9; color: #2e7d32;" onclick="checkSingleMedicine('${medicine.sku}')">Stock</button>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }

    // Helper functions for stock status
    function getStockStatus(quantity, threshold) {
        if (quantity === 0) return 'Out of Stock';
        if (quantity <= threshold) return 'Low Stock';
        if (quantity <= threshold * 2) return 'Medium Stock';
        return 'High Stock';
    }

    function getStockStatusClass(status) {
        switch(status) {
            case 'High Stock': return 'stock-high';
            case 'Medium Stock': return 'stock-medium';
            case 'Low Stock': return 'stock-low';
            case 'Out of Stock': return 'stock-out';
            default: return 'stock-out';
        }
    }

    function getStockColor(quantity, threshold) {
        if (quantity === 0) return '#c62828';
        if (quantity <= threshold) return '#ef6c00';
        if (quantity <= threshold * 2) return '#ff9800';
        return '#2e7d32';
    }

    // Edit medicine from table
    function editMedicine(sku) {
        setMode('update');
        document.getElementById('updateSku').value = sku;
        loadMedicineData();
    }

    // Check single medicine from table
    function checkSingleMedicine(sku) {
        setMode('stock-check');
        const medicine = medicinesData.find(m => m.sku === sku);
        if (medicine) {
            document.getElementById('checkMedicineName').value = medicine.name;
            checkStock();
        }
    }

    // Quick delete from table
    function confirmDeleteMedicine(sku, name) {
        if (confirm(`Are you sure you want to delete ${name} (${sku})?\n\nThis action cannot be undone.`)) {
            medicinesData = medicinesData.filter(m => m.sku !== sku);
            showMessage(`Medicine ${name} deleted!`, 'success');
            renderMedicinesTable();
        }
    }

    // Search medicines
    function searchMedicines() {
        const searchTerm = document.getElementById('medicineSearch').value.toLowerCase();
        if (!searchTerm) {
            renderMedicinesTable();
            return;
        }

        const filtered = medicinesData.filter(medicine =>
            medicine.sku.toLowerCase().includes(searchTerm) ||
            medicine.name.toLowerCase().includes(searchTerm) ||
            medicine.type.toLowerCase().includes(searchTerm) ||
            medicine.description.toLowerCase().includes(searchTerm)
        );

        const tableBody = document.getElementById('medicinesTableBody');
        tableBody.innerHTML = '';

        filtered.forEach(medicine => {
            const stockStatus = getStockStatus(medicine.quantity, medicine.threshold);
            const statusClass = getStockStatusClass(stockStatus);

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${medicine.sku}</td>
                <td><strong>${medicine.name}</strong><br><small style="color: #666;">${medicine.description.substring(0, 50)}${medicine.description.length > 50 ? '...' : ''}</small></td>
                <td>${medicine.type}</td>
                <td>${medicine.quantity}</td>
                <td>${medicine.threshold}</td>
                <td><span class="stock-badge ${statusClass}">${stockStatus}</span></td>
                <td>KSh ${medicine.price.toFixed(2)}</td>
                <td class="action-cell">
                    <button class="icon-btn edit-btn" onclick="editMedicine('${medicine.sku}')">Edit</button>
                    <button class="icon-btn delete-btn" onclick="confirmDeleteMedicine('${medicine.sku}', '${medicine.name}')">Delete</button>
                </td>
            `;
            tableBody.appendChild(row);
        });

        if (filtered.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="8" style="text-align: center; padding: 20px;">No medicines found matching "${searchTerm}"</td></tr>`;
        }
    }

    // Medicine Types Management
    function openMedicineTypesModal() {
        document.getElementById('medicineTypesModal').style.display = 'block';
        renderMedicineTypes();
    }

    function closeMedicineTypesModal() {
        document.getElementById('medicineTypesModal').style.display = 'none';
    }

    function renderMedicineTypes() {
        const typesList = document.getElementById('medicineTypesList');
        typesList.innerHTML = '';

        medicineTypes.forEach(type => {
            const typeDiv = document.createElement('div');
            typeDiv.className = 'type-item';
            typeDiv.innerHTML = `
                <div>
                    <strong style="text-transform: capitalize;">${type}</strong>
                    <div style="font-size: 12px; color: #666;">
                        ${medicinesData.filter(m => m.type === type).length} medicines
                    </div>
                </div>
                <div class="type-actions">
                    ${type !== 'other' ? `
                        <button class="small-btn danger-btn" onclick="deleteMedicineType('${type}')">Delete</button>
                    ` : ''}
                </div>
            `;
            typesList.appendChild(typeDiv);
        });
    }

    function addMedicineType() {
        const newType = document.getElementById('newTypeName').value.trim().toLowerCase();
        if (!newType) {
            alert('Please enter a type name');
            return;
        }

        if (medicineTypes.includes(newType)) {
            alert('This type already exists!');
            return;
        }

        medicineTypes.push(newType);
        document.getElementById('newTypeName').value = '';
        renderMedicineTypes();

        // Update select options
        updateTypeSelectOptions();
        showMessage(`Medicine type "${newType}" added successfully!`, 'success');
    }

    function deleteMedicineType(type) {
        if (medicinesData.some(m => m.type === type)) {
            alert(`Cannot delete "${type}" because there are medicines assigned to this type.\nPlease reassign those medicines first.`);
            return;
        }

        if (confirm(`Delete medicine type "${type}"?`)) {
            medicineTypes = medicineTypes.filter(t => t !== type);
            renderMedicineTypes();
            updateTypeSelectOptions();
            showMessage(`Medicine type "${type}" deleted!`, 'success');
        }
    }

    function updateTypeSelectOptions() {
        // Update all select elements with medicine types
        const selects = ['medicineType', 'updateType', 'checkMedicineType'];
        selects.forEach(selectId => {
            const select = document.getElementById(selectId);
            if (select) {
                const currentValue = select.value;
                select.innerHTML = '<option value="">Select Type</option>' +
                    medicineTypes.map(type =>
                        `<option value="${type}">${type.charAt(0).toUpperCase() + type.slice(1)}</option>`
                    ).join('');
                select.value = currentValue;
            }
        });
    }

    // Clear forms
    function clearForm() {
        document.getElementById('sku').value = '';
        document.getElementById('medicineName').value = '';
        document.getElementById('medicineType').value = '';
        document.getElementById('quantity').value = '';
        document.getElementById('lowStockThreshold').value = '';
        document.getElementById('price').value = '';
        document.getElementById('description').value = '';
        document.getElementById('expiryDate').value = '';
    }

    function clearUpdateForm() {
        document.getElementById('updateSku').value = '';
        document.getElementById('updateName').value = '';
        document.getElementById('updateType').value = '';
        document.getElementById('updateQuantity').value = '';
        document.getElementById('updateThreshold').value = '';
        document.getElementById('updatePrice').value = '';
    }

    function clearDeleteForm() {
        document.getElementById('deleteName').value = '';
        document.getElementById('confirmDeleteMedicine').value = '';
    }

    // Show message
    function showMessage(message, type) {
        const messageArea = document.getElementById('messageArea');
        messageArea.className = `message ${type}`;
        messageArea.textContent = message;
        messageArea.style.display = 'block';

        // Auto-hide after 5 seconds
        setTimeout(() => {
            messageArea.style.display = 'none';
        }, 5000);
    }

    // Navigation functions
    function showNotifications() {
        alert('Notifications would appear here');
    }

    function logout() {
        if (confirm('Are you sure you want to logout?')) {
            window.location.href = 'login.html';
        }
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
        const modal = document.getElementById('medicineTypesModal');
        if (event.target === modal) {
            closeMedicineTypesModal();
        }
    }
</script>
</body>
</html>